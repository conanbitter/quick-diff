<!DOCTYPE html>
<html>

<head>
    <style>
        .range {
            border-radius: 0.2em;
            padding: 0.2rlh;
        }

        .add {
            background-color: rgb(174, 204, 121);
            color: rgb(80, 122, 0);
        }

        .del {
            background-color: rgb(226, 147, 147);
            color: rgb(146, 0, 0);
        }

        .container {
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .container p {
            z-index: 1;
            position: relative;
            line-height: 1.5;
        }
    </style>
</head>

<body>
    <div class="container" id="container">
        <h1>Quick Diff</h1>
        <p id="text">
            Lorem <span class="range del">ipsum</span> dolor sit amet, <span class="range add">consectetur</span>
            adipiscing elit. In sed quam faucibus, posuere tortor ac,
            pellentesque
            elit. Aenean ac neque tellus. Integer nulla justo, blandit eget augue a, vulputate congue mauris. Proin sit
            amet
            diam <span class="range add">quis</span> odio <span class="range add">dignissim</span> vestibulum. Donec et
            convallis purus. Suspendisse laoreet nibh felis, sed pretium quam malesuada ut. Fusce commodo at tortor eu
            faucibus. <span class="range del">Mauris sed porta turpis.</span> Pellentesque mauris dui, commodo eu purus
            eleifend, dapibus blandit ex. Nullam fringilla, eros eget rutrum finibus, <span class="range add">urna
                dui</span> elementum ante, a vestibulum
            mi mauris et risus.
        </p>
    </div>
    <script>
        const container = document.getElementById('container');
        const spans_add = container.querySelectorAll('.add');
        const spans_del = container.querySelectorAll('.del');

        // create a container for highlight overlays
        const highlightContainer = document.createElement('div');
        highlightContainer.style.position = 'absolute';
        highlightContainer.style.top = '0';
        highlightContainer.style.left = '0';
        highlightContainer.style.width = '100%';
        highlightContainer.style.pointerEvents = 'none';
        highlightContainer.style.zIndex = '0'; // behind text
        container.style.position = 'relative';
        container.prepend(highlightContainer);

        const rectsByLine = new Map();

        spans_add.forEach(span => {
            const rects = span.getClientRects();
            for (const rect of rects) {
                // Round top value to group lines
                const lineTop = Math.round(rect.top);
                if (!rectsByLine.has(lineTop)) {
                    rectsByLine.set(lineTop, { rect, kind: "add" });
                }
            }
        });

        spans_del.forEach(span => {
            const rects = span.getClientRects();
            for (const rect of rects) {
                // Round top value to group lines
                const lineTop = Math.round(rect.top);
                if (!rectsByLine.has(lineTop)) {
                    rectsByLine.set(lineTop, { rect, kind: "del" });
                } else if (rectsByLine.get(lineTop).kind === "add") {
                    rectsByLine.set(lineTop, { rect, kind: "mix" });
                }
            }
        });

        for (const { rect, kind } of rectsByLine.values()) {
            let color = 'rgba(255, 255, 0, 0.3)';
            if (kind === "add") {
                color = 'rgba(0, 255, 0, 0.2)';
            } else if (kind === "del") {
                color = 'rgba(255, 0, 0, 0.2)';
            }

            const highlight = document.createElement('div');
            highlight.style.position = 'absolute';
            highlight.style.left = `$0px`;
            highlight.style.top = `${rect.top - container.getBoundingClientRect().top}px`;
            highlight.style.width = `${container.getBoundingClientRect().width}px`;
            highlight.style.height = `${rect.height}px`;
            highlight.style.background = color;
            highlight.style.borderRadius = '3px';
            highlightContainer.appendChild(highlight);
        }
    </script>
</body>

</html>